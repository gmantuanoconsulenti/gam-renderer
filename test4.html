<!DOCTYPE html>
<html>
    <head>
        <script>
            function getConsentFromStorage() {
                const raw = localStorage.getItem("user_consent");
                console.log("Raw consent from storage:", raw);
                try {
                    return raw ? JSON.parse(raw) : null;
                } catch {
                    return null;
                }
            }

            function getTcString() {
                const value = `; ${document.cookie}`;
                console.log("Cookie string:", value);
                const parts = value.split(`; euconsent=`);
                console.log(parts);
                if (parts.length === 2) {
                    return parts.pop().split(";").shift();
                }
                return null; // return null if not found
            }

            function saveConsentToStorage(consented) {
                const consentData = {
                    consensoDato: consented
                };
                localStorage.setItem("user_consent", JSON.stringify(consentData));
            }
            var adv_target = {
                "pdv_id": "DIMAR_MERCATO_203",
                "sport": "Football"
            };
            window.__tcfapi('getTCData', 2, (tcData, success) => {
            if (success) {
                console.log("TCData:", tcData);
                console.log(tcData.tcString); // È l’equivalente del valore del cookie euconsent-v2
            }
            });

            // Imposta la variabile globale adv_consent prima del caricamento framework
            var adv_consent = (function () {
                const stored = getConsentFromStorage();
                if (!stored) return { consensoDato: false }; // Nessuna scelta ancora
                return {
                    consensoDato: stored.consensoDato,
                    tcString: getTcString()
                };
            })();
    
        </script>
    
        <script src="https://gmantuanoconsulenti.github.io/gam-renderer/static/selex-adv-framework-ecommerce_test.js"></script>
        <script>
        dlApi = {
            target: "TEST/AREATEST",
            async: 1,
            cmpLang: "en-US",
            cmd: []
        };
        dlApi.cmd.push(function (dlApi) {
            dlApi.canBePersonalized(function (consent) {
                console.log("User consent for personalization:", consent);
                saveConsentToStorage(consent);
            });
        });
        </script>
        <script src="//lib.onet.pl/s.csr/build/dlApi/dl.boot.min.js" async></script>
    </head>
    <body>
        <h1>Ecommerce Test Ad Placements</h1>
        <h2>Banner Selex /23281620594/ecommerce_test/cosicomodo.it/mercato/homepage/slider_top4 </h2>
        <div id="adv-unit" data-adv-path="/23281620594/ecommerce_test/cosicomodo.it/mercato/homepage/slider_top4"></div>
    </body>
</html>