<!DOCTYPE html>
<html>
    <head>
        <script>
            function getConsentFromStorage() {
                const raw = localStorage.getItem("user_consent");
                console.log("Raw consent from storage:", raw);
                try {
                    return raw ? JSON.parse(raw) : null;
                } catch {
                    return null;
                }
            }

            function saveConsentToStorage(consented) {
                const stored = getConsentFromStorage() || {};
                stored.consensoDato = consented;
                localStorage.setItem("user_consent", JSON.stringify(stored));
            }
            function saveTcStringToStorage(consents) {
                console.log("Saving TC string to storage:", consents);
                const stored = getConsentFromStorage() || {};
                stored.tcString = consents.euConsent || '';
                console.log("Updated stored consent data:", stored);
                localStorage.setItem("user_consent", JSON.stringify(stored));
            }
            var adv_target = {
                "pdv_id": "DIMAR_MERCATO_203",
                "sport": "football"
            };
            // Imposta la variabile globale adv_consent prima del caricamento framework
            var adv_consent = (function () {
                const stored = getConsentFromStorage();
                if (!stored) return { consensoDato: false };
                return {
                    consensoDato: stored.consensoDato,
                    tcString: stored.tcString
                };
            })();
    
        </script>
    
        <script src="https://gmantuanoconsulenti.github.io/gam-renderer/static/selex-adv-framework-ecommerce_test.js"></script>
        <script>
        dlApi = {
            target: "TEST/AREATEST",
            async: 1,
            cmpLang: "en-US",
            cmd: []
        };
        dlApi.cmd.push(function (dlApi) {
            dlApi.getConsents(function (error, consent) {
                console.log("User consent for ads:", consent);
                saveTcStringToStorage(consent);
            });
            dlApi.canBePersonalized(function (consent) {
                console.log("User consent for personalization:", consent);
                saveConsentToStorage(consent);
            });
        });
        </script>
        <script src="//lib.onet.pl/s.csr/build/dlApi/dl.boot.min.js" async></script>
    </head>
    <body>
        <h1>Ecommerce Test Ad Placements</h1>
        <h2>Banner Selex /23281620594/ecommerce_test/cosicomodo.it/mercato/homepage/slider_top4 </h2>
        <div id="adv-unit" data-adv-path="/23281620594/ecommerce_test/cosicomodo.it/mercato/homepage/slider_top4"></div>
    </body>
</html>